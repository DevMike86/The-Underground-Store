<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nexus | LM Studio Terminal</title>
    <style>
        :root { --blue: #8ab4f8; --dark: #121212; --card: #202124; --text: #e8eaed; }
        body { background: var(--dark); color: var(--text); font-family: sans-serif; margin: 0; padding-bottom: 120px; overflow-x: hidden; }
        
        /* Header & Tabs */
        .hdr { background: var(--card); padding: 15px; border-bottom: 1px solid #3c4043; display: flex; justify-content: space-between; align-items: center; }
        .tabs { display: flex; background: var(--card); border-bottom: 1px solid #3c4043; position: sticky; top: 0; z-index: 10; }
        .tab { flex: 1; text-align: center; padding: 15px; color: #9aa0a6; cursor: pointer; font-weight: bold; font-size: 13px; }
        .tab.active { color: var(--blue); border-bottom: 3px solid var(--blue); }

        .view { display: none; padding: 20px; }
        .view.active { display: block; }

        /* Store Elements */
        .card { background: #303134; border-radius: 15px; padding: 20px; border: 1px solid #444; margin-bottom: 20px; }
        .dl-btn { background: var(--blue); color: #000; display: block; text-align: center; padding: 15px; border-radius: 8px; text-decoration: none; font-weight: bold; margin: 15px 0; }
        .stars { font-size: 30px; margin: 10px 0; display: flex; gap: 5px; color: #555; }
        .star.active { color: #fbbc04; }

        /* Inputs */
        input { width: 100%; padding: 12px; margin: 10px 0; background: #121212; border: 1px solid #555; color: #fff; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn { background: var(--blue); color: #000; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* AI DOCK (EXPANDABLE) */
        .ai-dock { position: fixed; bottom: 0; width: 100%; background: #000; border-top: 1px solid #3c4043; padding: 15px; box-sizing: border-box; transition: height 0.4s ease; z-index: 1000; height: 140px; }
        .ai-dock.expanded { height: 80vh; } 
        
        #ai-log { color: var(--blue); font-size: 14px; height: calc(100% - 90px); overflow-y: auto; margin-bottom: 10px; line-height: 1.5; }
        .ai-row { display: flex; gap: 10px; align-items: center; }
        .ai-msg { margin-bottom: 12px; padding: 8px; border-bottom: 1px solid #222; }
    </style>
</head>
<body>

<div class="hdr">
    <div style="color:#9aa0a6; font-size: 12px;">ENGINE: <span id="status" style="color:red;">OFFLINE</span></div>
    <div id="user-tag" style="color:var(--blue); font-weight:bold;">DevMike86</div>
</div>

<div class="tabs">
    <div class="tab active" onclick="go('store')">STORE</div>
    <div class="tab" onclick="go('admin')">ADMIN</div>
    <div class="tab" onclick="go('settings')">SETTINGS</div>
</div>

<div id="v-store" class="view active">
    <div class="card">
        <div style="display:flex; align-items:center; gap:15px;">
            <span style="font-size:40px;">ðŸ“¡</span>
            <div><h2 style="margin:0;">Nexus VPN</h2><small style="color:#00e676;">5.52 MB â€¢ Uncensored Build</small></div>
        </div>
        <a href="https://raw.githubusercontent.com/DevMike86/The-Underground-Store/main/VERIFIED_NexusVPN.apk" class="dl-btn">DOWNLOAD APK</a>
        <div class="stars">
            <span onclick="rate(1)">â˜…</span><span onclick="rate(2)">â˜…</span><span onclick="rate(3)">â˜…</span><span onclick="rate(4)">â˜…</span><span onclick="rate(5)">â˜…</span>
        </div>
        <div id="c-list"></div>
        <input type="text" id="c-in" placeholder="Write review...">
        <button class="btn" onclick="postComm()">POST</button>
    </div>
</div>

<div id="v-admin" class="view">
    <div class="card" id="lock">
        <h3>PIN Required</h3>
        <input type="password" id="pass" placeholder="1973">
        <button class="btn" onclick="unlock()">UNLOCK</button>
    </div>
    <div id="panel" style="display:none;" class="card">
        <h3>AI Malware Scan</h3>
        <input type="file">
        <button class="btn" onclick="addLog('AI', 'Scanning binary... Clean.')">SCAN</button>
    </div>
</div>

<div id="v-settings" class="view">
    <div class="card">
        <h3>Ngrok + LM Studio Link</h3>
        <p style="font-size:12px; color:#9aa0a6;">Paste your Ngrok URL (no /v1/ at the end):</p>
        <input type="text" id="api-url" placeholder="https://your-id.ngrok-free.app">
        <button class="btn" onclick="saveAPI()">LINK AI ENGINE</button>
    </div>
</div>

<div class="ai-dock" id="dock">
    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
        <small style="color:var(--blue)">NEXUS AI (LM STUDIO)</small>
        <small onclick="toggleAI()" style="cursor:pointer; color:#555;">[RESIZE]</small>
    </div>
    <div id="ai-log">
        <div class="ai-msg"><b>SYSTEM:</b> Link Ngrok in Settings to start.</div>
    </div>
    <div class="ai-row">
        <input type="text" id="ai-in" placeholder="Ask anything..." onfocus="expandAI()">
        <button class="btn" style="width:50px;" onclick="talk()">âž”</button>
        <button class="btn" style="width:50px; background:#444; color:#fff;" onclick="clr()">X</button>
    </div>
</div>

<script>
    let NGROK_URL = localStorage.getItem('nexus_ngrok') || "";
    if(NGROK_URL) { document.getElementById('status').innerText = "LINKED"; document.getElementById('status').style.color = "lime"; }

    function go(v) {
        document.querySelectorAll('.view').forEach(x => x.style.display = 'none');
        document.getElementById('v-' + v).style.display = 'block';
        collapseAI();
    }

    function toggleAI() { document.getElementById('dock').classList.toggle('expanded'); }
    function expandAI() { document.getElementById('dock').classList.add('expanded'); }
    function collapseAI() { document.getElementById('dock').classList.remove('expanded'); }

    function saveAPI() {
        NGROK_URL = document.getElementById('api-url').value.replace(/\/$/, ""); 
        localStorage.setItem('nexus_ngrok', NGROK_URL);
        document.getElementById('status').innerText = "LINKED";
        document.getElementById('status').style.color = "lime";
        addLog('SYSTEM', 'Ngrok Tunnel saved. Ready to transmit.');
    }

    function addLog(who, msg) {
        const log = document.getElementById('ai-log');
        log.innerHTML += `<div class="ai-msg"><b>${who}:</b> <span>${msg}</span></div>`;
        log.scrollTop = log.scrollHeight;
    }

    async function talk() {
        const i = document.getElementById('ai-in');
        const userMsg = i.value.trim();
        if(!userMsg || !NGROK_URL) return;

        addLog('You', userMsg);
        i.value = "";
        addLog('AI', 'Thinking...');

        try {
            const response = await fetch(`${NGROK_URL}/v1/chat/completions`, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'ngrok-skip-browser-warning': 'true' // Vital for Ngrok free tier
                },
                body: JSON.stringify({
                    model: "local-model", // LM Studio default
                    messages: [{ role: "user", content: userMsg }],
                    temperature: 0.7
                })
            });

            const data = await response.json();
            const aiReply = data.choices[0].message.content;
            
            // Remove "Thinking..." and add real reply
            const logs = document.getElementById('ai-log');
            logs.removeChild(logs.lastChild); 
            addLog('AI', aiReply);

        } catch (err) {
            addLog('AI', 'CONNECTION ERROR: Check LM Studio Server or Ngrok Link.');
            console.error(err);
        }
    }

    function postComm() {
        const val = document.getElementById('c-in').value;
        if(!val) return;
        document.getElementById('c-list').innerHTML += `<div style="background:#121212; padding:10px; border-radius:8px; margin-top:10px; font-size:14px; border-left:3px solid var(--blue);"><b>DevMike86:</b> ${val}</div>`;
        document.getElementById('c-in').value = "";
    }

    function unlock() {
        if(document.getElementById('pass').value === '1973') {
            document.getElementById('lock').style.display = 'none';
            document.getElementById('panel').style.display = 'block';
        }
    }

    function clr() { document.getElementById('ai-log').innerHTML = "<b>AI:</b> Logs cleared."; collapseAI(); }
</script>

</body>
</html>
